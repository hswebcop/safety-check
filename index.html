<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æ¯æ—¥å®‰å…¨æª¢æŸ¥ç³»çµ±</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
:root {
  --navy:#0d1117;--surface:#161b25;--card:#1e2535;--card2:#252d3d;
  --border:#2c3550;--teal:#00d4aa;--teal-dim:#00a882;--blue:#3d9eff;
  --red:#ff4d6d;--amber:#ffb020;--green:#2dd881;
  --text:#e2e8f0;--dim:#8892a4;--muted:#4a5568;--r:14px;--r-sm:8px;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html{scroll-behavior:smooth}
body{font-family:'Noto Sans TC',sans-serif;background:var(--navy);color:var(--text);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");pointer-events:none;z-index:0;opacity:.5}
.header{position:sticky;top:0;z-index:50;background:rgba(13,17,23,.92);backdrop-filter:blur(16px);border-bottom:1px solid var(--border);padding:14px 20px;display:flex;align-items:center;justify-content:space-between}
.header-brand{display:flex;align-items:center;gap:10px}
.header-brand .logo{width:34px;height:34px;background:linear-gradient(135deg,var(--teal),var(--blue));border-radius:var(--r-sm);display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:900;color:#fff;flex-shrink:0}
.header-brand .title{font-size:14px;font-weight:700;letter-spacing:.05em;line-height:1.2}
.header-brand .subtitle{font-size:11px;color:var(--dim);font-weight:400}
.header-time{font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--teal);text-align:right;line-height:1.5}

/* NOTICE BANNER */
.notice-banner{position:relative;background:linear-gradient(135deg,#1a1000,#2a1800);border:2px solid var(--amber);border-radius:var(--r);padding:16px 18px;margin-bottom:20px;overflow:hidden}
.notice-banner::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--amber),#ff8c00,var(--amber));background-size:200% 100%;animation:shimmer 2.5s linear infinite}
@keyframes shimmer{from{background-position:200% 0}to{background-position:-200% 0}}
.notice-banner-head{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.notice-banner-head .warn-icon{font-size:22px;animation:wobble 2s ease-in-out infinite}
@keyframes wobble{0%,100%{transform:rotate(0)}20%{transform:rotate(-8deg)}40%{transform:rotate(8deg)}60%{transform:rotate(-4deg)}80%{transform:rotate(4deg)}}
.notice-banner-head .warn-title{font-size:14px;font-weight:900;color:var(--amber);letter-spacing:.04em}
.notice-rules{list-style:none;padding:0}
.notice-rules li{display:flex;align-items:flex-start;gap:8px;font-size:12.5px;color:#d4b896;padding:4px 0;line-height:1.6;border-bottom:1px solid rgba(255,176,32,.1)}
.notice-rules li:last-child{border-bottom:none}
.notice-rules li::before{content:'â€º';color:var(--amber);font-weight:900;font-size:16px;flex-shrink:0;line-height:1.4}

main{position:relative;z-index:1;max-width:640px;margin:0 auto;padding:24px 16px 60px}

/* STEPS */
.steps{display:flex;align-items:center;margin-bottom:28px}
.step-item{display:flex;flex-direction:column;align-items:center;flex:1;position:relative}
.step-item:not(:last-child)::after{content:'';position:absolute;top:14px;left:calc(50% + 18px);right:calc(-50% + 18px);height:2px;background:var(--border);transition:background .4s}
.step-item.done:not(:last-child)::after{background:var(--teal)}
.step-dot{width:28px;height:28px;border-radius:50%;background:var(--card);border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:var(--dim);transition:all .3s;flex-shrink:0;font-family:'JetBrains Mono',monospace}
.step-item.active .step-dot{border-color:var(--teal);color:var(--teal);box-shadow:0 0 12px rgba(0,212,170,.3)}
.step-item.done .step-dot{background:var(--teal);border-color:var(--teal);color:#000;font-size:13px}
.step-label{margin-top:6px;font-size:10px;color:var(--dim);text-align:center;white-space:nowrap}
.step-item.active .step-label{color:var(--teal)}
.screen{display:none;animation:fadeUp .35s ease both}
.screen.active{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.section-title{font-size:22px;font-weight:900;margin-bottom:6px;letter-spacing:-.02em}
.section-sub{font-size:13px;color:var(--dim);margin-bottom:24px;line-height:1.6}

/* LOCATION CARDS */
.location-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
@media(max-width:420px){.location-grid{grid-template-columns:1fr 1fr;gap:10px}}
.loc-card{background:var(--card);border:2px solid var(--border);border-radius:var(--r);padding:22px 14px;text-align:center;cursor:pointer;transition:all .25s;position:relative;overflow:hidden}
.loc-card::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(0,212,170,.08),transparent);opacity:0;transition:opacity .25s}
.loc-card:hover::before,.loc-card:active::before{opacity:1}
.loc-card:hover,.loc-card:active{border-color:var(--teal);transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,212,170,.15)}
.loc-num{font-family:'JetBrains Mono',monospace;font-size:34px;font-weight:600;color:var(--teal);display:block;margin-bottom:4px;line-height:1}
.loc-name{font-size:11px;color:var(--dim);margin-top:2px}
.loc-badge{position:absolute;top:8px;right:8px;font-size:9px;padding:2px 6px;background:rgba(0,212,170,.12);color:var(--teal);border-radius:99px;font-family:'JetBrains Mono',monospace}

/* FORM */
.form-group{margin-bottom:16px}
.form-label{font-size:12px;font-weight:700;color:var(--dim);text-transform:uppercase;letter-spacing:.08em;margin-bottom:8px;display:block}
.form-control{width:100%;background:var(--card);border:1.5px solid var(--border);border-radius:var(--r-sm);color:var(--text);font-family:'Noto Sans TC',sans-serif;font-size:14px;padding:12px 14px;outline:none;transition:border-color .2s,box-shadow .2s;appearance:none;-webkit-appearance:none}
.form-control:focus{border-color:var(--teal);box-shadow:0 0 0 3px rgba(0,212,170,.15)}
.search-wrap{position:relative}
.search-wrap .form-control{padding-left:38px}
.search-icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--dim);font-size:15px;pointer-events:none}
.dropdown-list{position:absolute;top:calc(100% + 4px);left:0;right:0;background:var(--card2);border:1.5px solid var(--teal);border-radius:var(--r-sm);max-height:200px;overflow-y:auto;z-index:100;display:none;box-shadow:0 8px 24px rgba(0,0,0,.4)}
.dropdown-list.open{display:block}
.dropdown-item{padding:11px 14px;cursor:pointer;font-size:13px;border-bottom:1px solid var(--border);transition:background .15s;display:flex;align-items:center;gap:10px}
.dropdown-item:last-child{border-bottom:none}
.dropdown-item:hover{background:rgba(0,212,170,.1)}
.emp-id{font-family:'JetBrains Mono',monospace;font-size:11px;background:var(--border);padding:2px 6px;border-radius:4px;color:var(--dim);flex-shrink:0}
.ts-display{background:var(--card);border:1.5px solid var(--border);border-radius:var(--r-sm);padding:12px 14px;display:flex;align-items:center;justify-content:space-between}
.ts-display .ts-val{font-family:'JetBrains Mono',monospace;font-size:13px;color:var(--teal)}
.ts-display .ts-lbl{font-size:11px;color:var(--dim)}
.selected-tag{display:inline-flex;align-items:center;gap:6px;background:rgba(0,212,170,.12);border:1px solid rgba(0,212,170,.3);border-radius:99px;padding:4px 10px;font-size:12px;color:var(--teal);margin-top:8px}

/* CHECKLIST */
.location-block{background:var(--card);border:1.5px solid var(--border);border-radius:var(--r);margin-bottom:14px;overflow:hidden;transition:border-color .2s}
.location-block.loc-ok{border-color:var(--green)}
.location-block.loc-issue{border-color:var(--red)}
.loc-header{padding:14px 16px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;user-select:none}
.loc-header-left{display:flex;align-items:center;gap:10px}
.loc-icon{width:32px;height:32px;border-radius:var(--r-sm);display:flex;align-items:center;justify-content:center;font-size:16px;background:var(--card2);flex-shrink:0}
.loc-header-name{font-size:15px;font-weight:700}
.loc-header-count{font-size:11px;color:var(--dim);margin-top:1px}
.loc-status-btn{display:flex;gap:8px;align-items:center;flex-shrink:0}
.status-label{font-size:12px;font-weight:700;min-width:28px;text-align:right;transition:color .2s;letter-spacing:.02em}
.status-label.is-ok{color:var(--green)}
.status-label.is-issue{color:var(--red)}
.status-toggle{width:52px;height:28px;border-radius:99px;display:flex;align-items:center;position:relative;cursor:pointer;border:2px solid var(--green);background:rgba(45,216,129,.15);transition:all .25s;overflow:hidden;flex-shrink:0}
.status-toggle.is-issue{background:rgba(255,77,109,.15);border-color:var(--red)}
.status-toggle .toggle-knob{width:20px;height:20px;border-radius:50%;background:var(--green);position:absolute;left:calc(100% - 23px);transition:all .25s;display:flex;align-items:center;justify-content:center;font-size:11px;color:#000;font-weight:900}
.status-toggle.is-issue .toggle-knob{background:var(--red);left:2px;color:#fff}
.collapse-arrow{color:var(--dim);font-size:12px;transition:transform .2s;flex-shrink:0}
.location-block.open .collapse-arrow{transform:rotate(180deg)}
.loc-body{padding:12px 16px 14px;border-top:1px solid var(--border)}
.check-items-title{font-size:10px;font-weight:700;color:var(--dim);text-transform:uppercase;letter-spacing:.08em;margin-bottom:8px}
.check-item{display:flex;align-items:center;gap:10px;padding:8px 0;font-size:13px;color:var(--text);border-bottom:1px solid rgba(255,255,255,.04);line-height:1.5;cursor:pointer;transition:background .15s;border-radius:6px;padding-left:4px}
.check-item:last-child{border-bottom:none}
.check-item:hover{background:rgba(255,255,255,.03)}
.check-item.checked{color:var(--red)}
.check-item.checked .check-bullet{background:rgba(255,77,109,.2);border-color:var(--red);color:var(--red)}
.check-item.checked .check-text{text-decoration:none;font-weight:700}
.check-bullet{width:20px;height:20px;border-radius:5px;border:1.5px solid var(--muted);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;transition:all .2s;background:transparent}
.loc-note-area{margin-top:12px}
.loc-note-area textarea{width:100%;background:var(--card2);border:1.5px solid var(--border);border-radius:var(--r-sm);color:var(--text);font-family:'Noto Sans TC',sans-serif;font-size:12px;padding:10px 12px;resize:vertical;min-height:70px;outline:none;transition:border-color .2s}
.loc-note-area textarea:focus{border-color:var(--amber)}
.loc-note-area textarea::placeholder{color:var(--muted)}
.door-lock-row{background:var(--card);border:1.5px solid var(--border);border-radius:var(--r);padding:16px;display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.door-lock-label{display:flex;align-items:center;gap:10px;font-size:15px;font-weight:700}
.door-lock-label .icon{font-size:20px}
.notes-card{background:var(--card);border:1.5px solid var(--border);border-radius:var(--r);padding:16px;margin-bottom:14px}
.notes-card textarea{width:100%;background:transparent;border:none;color:var(--text);font-family:'Noto Sans TC',sans-serif;font-size:13px;resize:vertical;min-height:90px;outline:none;line-height:1.7}
.notes-card textarea::placeholder{color:var(--muted)}
.progress-wrap{background:var(--border);border-radius:99px;height:4px;margin-bottom:20px;overflow:hidden}
.progress-fill{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--teal),var(--blue));transition:width .4s ease}
.status-bar{background:var(--card);border:1.5px solid var(--border);border-radius:var(--r);padding:14px 16px;display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:8px}
.stat-chip{display:flex;align-items:center;gap:6px;font-size:12px}
.stat-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}

/* SUMMARY */
.summary-card{background:var(--card);border:1.5px solid var(--border);border-radius:var(--r);padding:20px;margin-bottom:14px}
.summary-card .s-title{font-size:11px;font-weight:700;color:var(--dim);text-transform:uppercase;letter-spacing:.08em;margin-bottom:12px}
.summary-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);font-size:13px}
.summary-row:last-child{border-bottom:none}
.summary-row .s-label{color:var(--dim)}
.summary-row .s-val{font-weight:700}
.s-val.ok{color:var(--green)}.s-val.ng{color:var(--red)}.s-val.info{color:var(--teal);font-family:'JetBrains Mono',monospace;font-size:12px}
.ls-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(255,255,255,.04);font-size:13px}
.ls-row:last-child{border-bottom:none}
.ls-badge{font-size:10px;font-weight:700;padding:3px 9px;border-radius:99px}
.ls-badge.ok{background:rgba(45,216,129,.15);color:var(--green)}.ls-badge.ng{background:rgba(255,77,109,.15);color:var(--red)}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;border:none;border-radius:var(--r-sm);font-family:'Noto Sans TC',sans-serif;font-size:14px;font-weight:700;padding:14px 20px;cursor:pointer;transition:all .2s;text-decoration:none;outline:none}
.btn-primary{background:linear-gradient(135deg,var(--teal),var(--blue));color:#000;width:100%;box-shadow:0 4px 16px rgba(0,212,170,.25)}
.btn-primary:hover,.btn-primary:active{transform:translateY(-1px);box-shadow:0 6px 20px rgba(0,212,170,.35)}
.btn-primary:disabled{opacity:.4;cursor:not-allowed;transform:none}
.btn-outline{background:transparent;color:var(--dim);border:1.5px solid var(--border);width:100%;margin-top:10px}
.btn-outline:hover{border-color:var(--dim);color:var(--text)}
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--card2);border:1.5px solid var(--border);border-radius:var(--r);padding:12px 20px;font-size:13px;color:var(--text);box-shadow:0 8px 24px rgba(0,0,0,.4);z-index:200;transition:transform .3s;white-space:nowrap;display:flex;align-items:center;gap:10px}
.toast.show{transform:translateX(-50%) translateY(0)}
.toast.toast-ok{border-color:var(--green)}.toast.toast-err{border-color:var(--red)}
.spinner{width:20px;height:20px;border-radius:50%;border:2px solid rgba(0,0,0,.2);border-top-color:#000;animation:spin .6s linear infinite;display:none}
@keyframes spin{to{transform:rotate(360deg)}}
::-webkit-scrollbar{width:4px;height:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
</style>
</head>
<body>

<header class="header">
  <div class="header-brand">
    <div class="logo">âœ“</div>
    <div>
      <div class="title">æ¯æ—¥å®‰å…¨æª¢æŸ¥</div>
      <div class="subtitle">Daily Safety Inspection</div>
    </div>
  </div>
  <div class="header-time">
    <div id="timeDisplay">--:--:--</div>
    <div id="dateDisplay" style="font-size:10px;color:var(--dim)"></div>
  </div>
</header>

<main>
  <!-- å…¨åŸŸé¡¯çœ¼å‚™è¨» -->
  <div class="notice-banner">
    <div class="notice-banner-head">
      <span class="warn-icon">âš ï¸</span>
      <span class="warn-title">æœ€å¾Œé›¢é–‹åŒä»ï¼Œè«‹å”åŠ©é€²è¡Œå®‰å…¨æª¢æŸ¥</span>
    </div>
    <ul class="notice-rules">
      <li>å„é›»è…¦ä½¿ç”¨è€…æ–¼ä¸‹ç­å¾Œé—œé–‰æˆ–ä¼‘çœ å„é›»è…¦é›»æºï¼Œç”±æœ€å¾Œé›¢é–‹äººå“¡æ–¼é›¢é–‹å…¬å¸å‰è² è²¬å†ç¢ºèªä¸€æ¬¡</li>
      <li>å°è¡¨æ©Ÿæ’é ­ç„¡é ˆæ‹”é™¤ï¼Œä½†éœ€é—œé–‰å­é›»æº</li>
      <li>å¦‚ç•¶é€±å€¼æ—¥ç”Ÿé›¢é–‹å‰å°šæœ‰äººå“¡ç•™åœ¨å…¬å¸ï¼Œç”±æœ€å¾Œé›¢é–‹å…¬å¸äººå“¡å®Œæˆå¾ŒçºŒç¢ºèª</li>
    </ul>
  </div>

  <!-- STEPS -->
  <div class="steps" id="stepIndicator">
    <div class="step-item active" id="stepEl-1"><div class="step-dot">1</div><div class="step-label">å ´æ‰€</div></div>
    <div class="step-item" id="stepEl-2"><div class="step-dot">2</div><div class="step-label">äººå“¡</div></div>
    <div class="step-item" id="stepEl-3"><div class="step-dot">3</div><div class="step-label">æª¢æŸ¥</div></div>
    <div class="step-item" id="stepEl-4"><div class="step-dot" style="font-size:14px">âœ“</div><div class="step-label">å®Œæˆ</div></div>
  </div>

  <!-- SCREEN 1: å ´æ‰€ -->
  <div class="screen active" id="screen1">
    <div class="section-title">é¸æ“‡å ´æ‰€</div>
    <div class="section-sub">è«‹ç¢ºèªä»Šæ—¥è¦é€²è¡Œå®‰å…¨æª¢æŸ¥çš„å ´æ‰€</div>
    <div class="location-grid">
      <div class="loc-card" onclick="selectLocation('665')">
        <div class="loc-badge">Aæ£Ÿ</div>
        <span class="loc-num">665</span>
        <div style="font-size:13px;font-weight:700;margin-top:4px">ç¸½å…¬å¸</div>
        <div class="loc-name">7å€‹åœ°é»</div>
      </div>
      <div class="loc-card" onclick="selectLocation('663')">
        <div class="loc-badge">Bæ£Ÿ</div>
        <span class="loc-num">663</span>
        <div style="font-size:13px;font-weight:700;margin-top:4px">åˆ†éƒ¨</div>
        <div class="loc-name">6å€‹åœ°é»</div>
      </div>
      <div class="loc-card" onclick="selectLocation('factory')">
        <div class="loc-badge">å» å€</div>
        <span class="loc-num" style="font-size:28px;line-height:1.2;padding-top:2px">ğŸ­</span>
        <div style="font-size:13px;font-weight:700;margin-top:6px">å·¥å» </div>
        <div class="loc-name">13å€‹åœ°é»</div>
      </div>
    </div>
  </div>

  <!-- SCREEN 2: äººå“¡ -->
  <div class="screen" id="screen2">
    <div class="section-title">æª¢æŸ¥äººå“¡è³‡è¨Š</div>
    <div class="section-sub">è«‹è¼¸å…¥å·¥è™Ÿæˆ–è‹±æ–‡å§“åæœå°‹é¸å–</div>

    <div class="form-group">
      <label class="form-label">ğŸ‘¤ æª¢æŸ¥äººå“¡</label>
      <div class="search-wrap">
        <span class="search-icon">ğŸ”</span>
        <input type="text" class="form-control" id="inspectorSearch"
          placeholder="è¼¸å…¥å·¥è™Ÿæˆ–å§“åæœå°‹..."
          oninput="filterEmployees('inspector')" onfocus="openDropdown('inspector')" autocomplete="off">
        <div class="dropdown-list" id="inspectorDropdown"></div>
      </div>
      <div id="inspectorSelected" class="selected-tag" style="display:none"></div>
    </div>

    <div class="form-group" id="lockerGroup" style="display:none">
      <label class="form-label">ğŸ”‘ é–é–€è€…ï¼ˆå·¥å» ï¼‰</label>
      <div class="search-wrap">
        <span class="search-icon">ğŸ”</span>
        <input type="text" class="form-control" id="lockerSearch"
          placeholder="è¼¸å…¥å·¥è™Ÿæˆ–è‹±æ–‡å§“åæœå°‹..."
          oninput="filterEmployees('locker')" onfocus="openDropdown('locker')" autocomplete="off">
        <div class="dropdown-list" id="lockerDropdown"></div>
      </div>
      <div id="lockerSelected" class="selected-tag" style="display:none"></div>
    </div>

    <div class="form-group">
      <label class="form-label">ğŸ• æª¢æŸ¥æ—¥æœŸ / æ™‚é–“</label>
      <div class="ts-display">
        <div><div class="ts-lbl">è‡ªå‹•è¨˜éŒ„</div><div class="ts-val" id="tsFullDisplay">è¼‰å…¥ä¸­...</div></div>
        <div style="font-size:20px">ğŸ“‹</div>
      </div>
    </div>

    <button class="btn btn-primary" onclick="goToStep3()"><span>é–‹å§‹å®‰å…¨æª¢æŸ¥</span><span style="font-size:16px">â†’</span></button>
    <button class="btn btn-outline" onclick="goToStep(1)">â† è¿”å›å ´æ‰€é¸æ“‡</button>
  </div>

  <!-- SCREEN 3: æª¢æŸ¥ -->
  <div class="screen" id="screen3">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
      <div class="section-title" id="checkTitle">å®‰å…¨æª¢æŸ¥</div>
      <div style="font-size:11px;font-family:'JetBrains Mono',monospace;color:var(--teal);background:rgba(0,212,170,.1);padding:4px 10px;border-radius:99px" id="locationBadge"></div>
    </div>
    <div class="section-sub">è«‹ä¾åºç¢ºèªå„æª¢æŸ¥åœ°é»ï¼Œé»æ“Šå³å´æŒ‰éˆ•åˆ‡æ› OKï¼ç•°å¸¸</div>
    <div class="progress-wrap"><div class="progress-fill" id="progressBar" style="width:0%"></div></div>
    <div class="status-bar">
      <div class="stat-chip"><div class="stat-dot" style="background:var(--green)"></div><span id="statOk">æ­£å¸¸: 0</span></div>
      <div class="stat-chip"><div class="stat-dot" style="background:var(--red)"></div><span id="statNg">ç•°å¸¸: 0</span></div>
    </div>
    <div id="checklistContainer"></div>
    <div class="notes-card">
      <label class="form-label" style="margin-bottom:8px">ğŸ“ æ•´é«”å‚™è¨» / ç•°å¸¸èªªæ˜</label>
      <textarea id="overallNotes" placeholder="å¦‚æœ‰ç•°å¸¸æƒ…æ³ï¼Œè«‹åœ¨æ­¤èªªæ˜ï¼ˆé¸å¡«ï¼‰..."></textarea>
    </div>
    <button class="btn btn-primary" onclick="submitCheck()" id="btnSubmit">
      <span>é€å‡ºå®‰å…¨æª¢æŸ¥</span><div class="spinner" id="submitSpinner"></div>
    </button>
    <button class="btn btn-outline" onclick="goToStep(2)">â† è¿”å›</button>
  </div>

  <!-- SCREEN 4: å®Œæˆ -->
  <div class="screen" id="screen4">
    <div style="text-align:center;padding:30px 0 20px">
      <div style="font-size:60px;margin-bottom:12px">âœ…</div>
      <div class="section-title" style="justify-content:center;display:flex">æª¢æŸ¥å®Œæˆï¼</div>
      <div class="section-sub" style="text-align:center">å®‰å…¨æª¢æŸ¥ç´€éŒ„å·²æˆåŠŸé€å‡º</div>
    </div>
    <div class="summary-card">
      <div class="s-title">ğŸ“‹ æœ¬æ¬¡æª¢æŸ¥æ‘˜è¦</div>
      <div class="summary-row"><span class="s-label">å ´æ‰€</span><span class="s-val" id="sumLocation"></span></div>
      <div class="summary-row"><span class="s-label">æª¢æŸ¥äººå“¡</span><span class="s-val" id="sumInspector"></span></div>
      <div class="summary-row" id="sumLockerRow"><span class="s-label">é–é–€è€…</span><span class="s-val" id="sumLocker"></span></div>
      <div class="summary-row"><span class="s-label">æª¢æŸ¥æ™‚é–“</span><span class="s-val info" id="sumTime"></span></div>
      <div class="summary-row"><span class="s-label">å¤§é–€ä¸Šé–</span><span class="s-val" id="sumDoor"></span></div>
      <div class="summary-row"><span class="s-label">å…¨éƒ¨åœ°é»æ­£å¸¸</span><span class="s-val" id="sumAllOk"></span></div>
    </div>
    <div class="summary-card">
      <div class="s-title">ğŸ“ åœ°é»ç‹€æ…‹</div>
      <div id="locationSummaryList"></div>
    </div>
    <button class="btn btn-primary" onclick="resetApp()" style="margin-top:4px">
      <span style="font-size:16px">ğŸ”„</span> é€²è¡Œæ–°çš„æª¢æŸ¥
    </button>
  </div>
</main>

<div class="toast" id="toast"><span id="toastIcon">â„¹ï¸</span><span id="toastMsg"></span></div>

<script>
const CONFIG = { GAS_URL:'https://script.google.com/macros/library/d/1P2Jr-D8lVY2-DRQ7il5up5NkaFkv0j2stkIsuIyH72KFxSO4uwYMgLwL/10', DEMO_MODE:false };

const LOCATIONS = {
  '665':{title:'665 ç¸½å…¬å¸',showLocker:false,places:[
    {id:'gm',name:'ç¸½ç¶“ç†è¾¦å…¬å®¤',icon:'ğŸ¢',items:['é›»è…¦é›»æºé—œé–‰','é™¤å¿…è¦æ’é ­ï¼Œå…¶ä»–æ’é ­æ·¨ç©º','å†·æ°£é—œé–‰','ç™¾è‘‰çª—å…¨é—œ','é–€ä¸Šé–']},
    {id:'big',name:'å¤§è¾¦å…¬å®¤',icon:'ğŸ–¥',items:['å„é›»è…¦é›»æºé—œé–‰','é™¤å¿…è¦æ’é ­ï¼Œå…¶ä»–æ’é ­æ·¨ç©º','å°è¡¨æ©Ÿå­é›»æºé—œé–‰','ç¶²è·¯é›»æºé—œé–‰ï¼Œæ’é ­æ‹”é™¤','å†·æ°£é—œé–‰']},
    {id:'tra',name:'åœ‹è²¿æœƒè¨ˆå®¤',icon:'ğŸ“Š',items:['å„é›»è…¦é›»æºé—œé–‰','é™¤å¿…è¦æ’é ­ï¼Œå…¶ä»–æ’é ­æ·¨ç©º','é–€ä¸Šé–','å†·æ°£é—œé–‰']},
    {id:'acc',name:'å¸³å‹™å®¤',icon:'ğŸ“‚',items:['é™¤å¿…è¦æ’é ­ï¼Œå…¶ä»–æ’é ­æ·¨ç©º','é–€ç¢ºèªä¸Šé–']},
    {id:'smp',name:'æ¨£å“å®¤',icon:'ğŸ“¦',items:['é™¤å¿…è¦æ’é ­ï¼Œå…¶ä»–æ’é ­æ·¨ç©º']},
    {id:'mtg',name:'æœƒè­°å®¤',icon:'ğŸ¤',items:['é™¤å¿…è¦æ’é ­ï¼Œå…¶ä»–æ’é ­æ·¨ç©º','å†·æ°£é—œé–‰']},
    {id:'bar',name:'å§æª¯',icon:'â˜•',items:['é™¤å¿…è¦æ’é ­ï¼Œå…¶ä»–æ’é ­æ·¨ç©º','å†·æ°£é—œé–‰','å†·æ°£å†°æ°´é–‹é—œé—œé–‰']},
  ]},
  '663':{title:'663 åˆ†éƒ¨',showLocker:false,places:[
    {id:'biz',name:'æ¥­å‹™è¾¦å…¬å®¤',icon:'ğŸ’¼',items:['é›»è…¦é›»æºé—œé–‰','é™¤å¿…è¦æ’é ­ï¼Œå…¶ä»–æ’é ­æ·¨ç©º','å†·æ°£å†°æ°´é–‹é—œé—œé–‰','å†·æ°£é—œé–‰']},
    {id:'trn',name:'è¨“ç·´æ•™å®¤å€',icon:'ğŸ«',items:['é™¤å¿…è¦æ’é ­ï¼Œå…¶ä»–æ’é ­æ·¨ç©º','å†·æ°£é—œé–‰','å¤§é–€ä¸Šé–']},
    {id:'ofc',name:'è¾¦å…¬å®¤',icon:'ğŸ–¥',items:['å„é›»è…¦é›»æºé—œé–‰','é™¤å¿…è¦æ’é ­ï¼Œå…¶ä»–æ’é ­æ·¨ç©º','å†·æ°£é—œé–‰']},
    {id:'gym',name:'å¥èº«æˆ¿',icon:'ğŸ’ª',items:['é™¤å¿…è¦æ’é ­ï¼Œå…¶ä»–æ’é ­æ·¨ç©º','å†·æ°£é—œé–‰']},
    {id:'mtg663',name:'æœƒè­°å®¤',icon:'ğŸ¤',items:['é™¤å¿…è¦æ’é ­ï¼Œå…¶ä»–æ’é ­æ·¨ç©º','å†·æ°£é—œé–‰']},
    {id:'str',name:'å„²è—å®¤',icon:'ğŸ“¦',items:['é™¤å¿…è¦æ’é ­ï¼Œå…¶ä»–æ’é ­æ·¨ç©º','å†·æ°£é—œé–‰']},
  ]},
  'factory':{title:'å·¥å» ',showLocker:true,places:[
    {id:'mic',name:'å¾®ç”Ÿç‰©å®¤',icon:'ğŸ”¬',items:['éå¿…è¦æ’é ­å…¨éƒ½ç§»é™¤','ç©ºå£“æ©Ÿæ’é ­ç§»é™¤','å†·æ°£é—œé–‰','é›»ç‡ˆå…¨éƒ¨é—œé–‰']},
    {id:'ana',name:'åˆ†æå®¤',icon:'ğŸ§ª',items:['éå¿…è¦æ’é ­å…¨éƒ½ç§»é™¤','é›»è…¦é—œé–‰','æ°´é¾é ­ç·Šé–‰','å†·æ°£é—œé–‰','é›»ç‡ˆå…¨éƒ¨é—œé–‰']},
    {id:'lab',name:'å¯¦é©—å®¤',icon:'ğŸ§«',items:['éå¿…è¦æ’é ­å…¨éƒ½ç§»é™¤','é›»è…¦é—œé–‰','æ°´é¾é ­ç·Šé–‰','åƒåœ¾å›æ”¶','å†·æ°£é—œé–‰','é›»ç‡ˆå…¨éƒ¨é—œé–‰','å†·è—åº«æº«åº¦ï¼ˆâ‰¦7â„ƒï¼‰','å†·å‡åº«æº«åº¦ï¼ˆâ‰¦-18â„ƒï¼‰']},
    {id:'drs',name:'æ›´è¡£å®¤ â˜…',icon:'ğŸ‘”',items:['éå¿…è¦æ’é ­å…¨éƒ½ç§»é™¤','æ°´é¾é ­ç·Šé–‰']},
    {id:'pkg',name:'åŒ…è£å®¤ï¼æ··æ–™å®¤ â˜…',icon:'ğŸ“¦',items:['å†·æ°£é—œé–‰','é›»ç‡ˆå…¨éƒ¨é—œé–‰']},
    {id:'mix',name:'é…æ–™å®¤ â˜…',icon:'âš—ï¸',items:['å†·æ°£é—œé–‰','é›»ç‡ˆå…¨éƒ¨é—œé–‰']},
    {id:'mtgF',name:'æœƒè­°å®¤',icon:'ğŸ¤',items:['éå¿…è¦æ’é ­å…¨éƒ½ç§»é™¤','æ°´é¾é ­ç·Šé–‰','å†·æ°£é—œé–‰','é›»ç‡ˆå…¨éƒ¨é—œé–‰']},
    {id:'fin',name:'æˆå“å®¤',icon:'ğŸ·',items:['éå¿…è¦æ’é ­å…¨éƒ½ç§»é™¤','çª—æˆ¶ç·Šé–‰','å†·æ°£é—œé–‰','é›»ç‡ˆé—œé–‰']},
    {id:'add',name:'é£Ÿå“æ·»åŠ ç‰©å®¤',icon:'ğŸ§‚',items:['éå¿…è¦æ’é ­å…¨éƒ½ç§»é™¤','çª—æˆ¶ç·Šé–‰','å†·æ°£é—œé–‰','é›»ç‡ˆé—œé–‰']},
    {id:'buf',name:'åŒ…æå®¤ï¼ç·©è¡å€ â˜…',icon:'ğŸ“«',items:['å†·æ°£é—œé–‰','é›»ç‡ˆå…¨éƒ¨é—œé–‰']},
    {id:'whs',name:'å€‰å„²',icon:'ğŸ—',items:['éå¿…è¦æ’é ­å…¨éƒ½ç§»é™¤','é™¤æ¿•æ©Ÿå€’æ°´ä¸”é—œé–‰','çª—æˆ¶ç·Šé–‰','å†·æ°£é—œé–‰','é›»ç‡ˆå…¨éƒ¨é—œé–‰']},
    {id:'hall',name:'èµ°å»Š',icon:'ğŸšª',items:['å†·æ°£é—œé–‰','é›»ç‡ˆå…¨éƒ¨é—œé–‰']},
    {id:'elec',name:'é›»ç®±',icon:'âš¡',items:['å†·æ°£ç¸½é–‹é—œé—œé–‰','é›»ç‡ˆé—œé–‰']},
  ]},
};

let EMPLOYEES=[
  {id:'A001',name:'ç‹å¤§æ˜',nameEn:'Wang Da-Ming'},
  {id:'A002',name:'æ—ç¾èŠ³',nameEn:'Lin Mei-Fang'},
  {id:'A003',name:'å¼µå»ºåœ‹',nameEn:'Chang Chien-Kuo'},
  {id:'B001',name:'é™³é›…ç²',nameEn:'Chen Ya-Ling'},
  {id:'B002',name:'åŠ‰å¿—æˆ',nameEn:'Liu Chih-Cheng'},
  {id:'B003',name:'é»ƒæ·‘æƒ ',nameEn:'Huang Shu-Hui'},
  {id:'C001',name:'å³ä¿Šå‚‘',nameEn:'Wu Chun-Chieh'},
  {id:'C002',name:'è”¡ä½©å›',nameEn:'Tsai Pei-Chun'},
];

const state={currentStep:1,location:null,inspectorEmployee:null,lockerEmployee:null,checkTimestamp:null,checks:{},placeNotes:{},subChecks:{},doorLocked:true,overallNotes:''};

document.addEventListener('DOMContentLoaded',()=>{
  startClock();
  if(!CONFIG.DEMO_MODE)loadEmployees();
  document.addEventListener('click',e=>{if(!e.target.closest('.search-wrap'))closeAllDropdowns()});
});

function startClock(){
  function tick(){
    const now=new Date();
    const hms=now.toLocaleTimeString('zh-TW',{hour12:false});
    const date=now.toLocaleDateString('zh-TW',{year:'numeric',month:'2-digit',day:'2-digit',weekday:'short'});
    document.getElementById('timeDisplay').textContent=hms;
    document.getElementById('dateDisplay').textContent=date;
    const el=document.getElementById('tsFullDisplay');
    if(el)el.textContent=`${now.getFullYear()}/${String(now.getMonth()+1).padStart(2,'0')}/${String(now.getDate()).padStart(2,'0')} ${hms}`;
  }
  tick();setInterval(tick,1000);
}

async function loadEmployees(){
  try{const res=await fetch(`${CONFIG.GAS_URL}?action=getEmployees`);const data=await res.json();if(data.employees)EMPLOYEES=data.employees;}catch(e){console.warn(e);}
}

function goToStep(n){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(`screen${n}`).classList.add('active');
  state.currentStep=n;
  updateStepUI(n);
  window.scrollTo({top:0,behavior:'smooth'});
}

function updateStepUI(active){
  [1,2,3,4].forEach(i=>{
    const el=document.getElementById(`stepEl-${i}`);
    el.classList.remove('active','done');
    if(i<active)el.classList.add('done');
    else if(i===active)el.classList.add('active');
  });
  [1,2,3].forEach(i=>{
    const dot=document.querySelector(`#stepEl-${i} .step-dot`);
    dot.textContent=i<active?'âœ“':String(i);
  });
}

function selectLocation(loc){
  state.location=loc;
  state.checkTimestamp=new Date();
  const ld=LOCATIONS[loc];
  document.getElementById('locationBadge').textContent=ld.title;
  document.getElementById('checkTitle').textContent=`${ld.title} å®‰å…¨æª¢æŸ¥`;
  document.getElementById('lockerGroup').style.display=ld.showLocker?'block':'none';
  goToStep(2);
}

function openDropdown(type){
  const sid=type==='inspector'?'inspectorSearch':'lockerSearch';
  renderDropdown(type,document.getElementById(sid).value);
  document.getElementById(`${type}Dropdown`).classList.add('open');
}
function closeAllDropdowns(){document.querySelectorAll('.dropdown-list').forEach(d=>d.classList.remove('open'));}
function filterEmployees(type){
  const sid=type==='inspector'?'inspectorSearch':'lockerSearch';
  renderDropdown(type,document.getElementById(sid).value);
}
function renderDropdown(type,query){
  const dd=document.getElementById(`${type}Dropdown`);
  const q=query.trim().toLowerCase();
  const filtered=q===''?EMPLOYEES:EMPLOYEES.filter(e=>e.id.toLowerCase().includes(q)||e.name.includes(q)||e.nameEn.toLowerCase().includes(q));
  dd.innerHTML=filtered.slice(0,10).map(e=>`<div class="dropdown-item" onclick="selectEmployee('${type}','${e.id}')"><span class="emp-id">${e.id}</span><span>${e.nameEn}</span></div>`).join('')||'<div class="dropdown-item" style="color:var(--dim)">æŸ¥ç„¡ç¬¦åˆäººå“¡</div>';
  dd.classList.add('open');
}
function selectEmployee(type,empId){
  const emp=EMPLOYEES.find(e=>e.id===empId);if(!emp)return;
  if(type==='inspector'){
    state.inspectorEmployee=emp;
    document.getElementById('inspectorSearch').value='';
    const t=document.getElementById('inspectorSelected');t.style.display='inline-flex';
    t.innerHTML=`<span>âœ“</span> ${emp.id} ${emp.nameEn}`;
  }else{
    state.lockerEmployee=emp;
    document.getElementById('lockerSearch').value='';
    const t=document.getElementById('lockerSelected');t.style.display='inline-flex';
    t.innerHTML=`<span>âœ“</span> ${emp.id} ${emp.nameEn}`;
  }
  closeAllDropdowns();
}

function goToStep3(){
  if(!state.inspectorEmployee){showToast('è«‹å…ˆé¸æ“‡æª¢æŸ¥äººå“¡','err');return;}
  const ld=LOCATIONS[state.location];
  if(ld.showLocker&&!state.lockerEmployee){showToast('å·¥å» å ´æ‰€è«‹é¸æ“‡é–é–€è€…','err');return;}
  buildChecklist();goToStep(3);
}

function buildChecklist(){
  const ld=LOCATIONS[state.location];
  const container=document.getElementById('checklistContainer');
  container.innerHTML='';
  state.checks={};state.placeNotes={};state.doorLocked=null;
  ld.places.forEach(p=>{state.checks[p.id]='ok';state.placeNotes[p.id]='';state.subChecks[p.id]={};});

  ld.places.forEach(place=>{
    const block=document.createElement('div');
    block.className='location-block loc-ok';block.id=`loc-block-${place.id}`;
    block.innerHTML=`
      <div class="loc-header" onclick="toggleLocBody('${place.id}')">
        <div class="loc-header-left">
          <div class="loc-icon">${place.icon}</div>
          <div><div class="loc-header-name">${place.name}</div><div class="loc-header-count">${place.items.length} é …ç¢ºèªé …ç›®</div></div>
        </div>
        <div class="loc-status-btn">
          <span class="status-label is-ok" id="lbl-${place.id}">æ­£å¸¸</span>
          <div class="status-toggle" id="toggle-${place.id}" onclick="event.stopPropagation();cycleStatus('${place.id}')">
            <div class="toggle-knob" id="knob-${place.id}">âœ“</div>
          </div>
          <span class="collapse-arrow" id="arrow-${place.id}">â–¼</span>
        </div>
      </div>
      <div class="loc-body" id="loc-body-${place.id}" style="display:none">
        <div class="check-items-title">ğŸ“‹ ç¢ºèªé …ç›®ï¼ˆç•°å¸¸è«‹é»æ“Šæ¨™è¨˜ï¼‰</div>
        ${place.items.map((item,i)=>`<div class="check-item" id="ci-${place.id}-${i}" onclick="toggleCheckItem('${place.id}',${i})"><div class="check-bullet" id="cb-${place.id}-${i}"></div><span class="check-text">${item}</span></div>`).join('')}
        <div class="loc-note-area"><textarea placeholder="æ­¤åœ°é»å‚™è¨» / ç•°å¸¸èªªæ˜ï¼ˆé¸å¡«ï¼‰..." oninput="state.placeNotes['${place.id}']=this.value" id="note-${place.id}"></textarea></div>
      </div>`;
    container.appendChild(block);
  });

  const doorRow=document.createElement('div');
  doorRow.className='door-lock-row';
  doorRow.innerHTML=`
    <div class="door-lock-label"><span class="icon">ğŸ”’</span><span>å¤§é–€ä¸Šé–ç¢ºèª</span></div>
    <div style="display:flex;align-items:center;gap:8px">
      <span class="status-label is-ok" id="lbl-door">æ­£å¸¸</span>
      <div class="status-toggle" id="toggle-door" onclick="cycleDoor()">
        <div class="toggle-knob" id="knob-door">âœ“</div>
      </div>
    </div>`;
  container.appendChild(doorRow);
  updateStats();
}

function toggleLocBody(id){
  const body=document.getElementById(`loc-body-${id}`);
  const block=document.getElementById(`loc-block-${id}`);
  const open=body.style.display==='block';
  body.style.display=open?'none':'block';
  block.classList.toggle('open',!open);
}

function cycleStatus(id){
  const c=state.checks[id];
  const n=c==='ok'?'issue':'ok';
  state.checks[id]=n;updateToggleUI(id,n);updateStats();
}
function updateToggleUI(id,val){
  const toggle=document.getElementById(`toggle-${id}`);
  const knob=document.getElementById(`knob-${id}`);
  const block=document.getElementById(`loc-block-${id}`);
  const lbl=document.getElementById(`lbl-${id}`);
  toggle.classList.remove('is-ok','is-issue');
  if(block)block.classList.remove('loc-ok','loc-issue');
  if(lbl){lbl.classList.remove('is-ok','is-issue');}
  if(val==='ok'){
    toggle.classList.remove('is-issue');
    knob.textContent='âœ“';
    if(block)block.classList.add('loc-ok');
    if(lbl){lbl.textContent='æ­£å¸¸';lbl.classList.add('is-ok');}
  }else if(val==='issue'){
    toggle.classList.add('is-issue');
    knob.textContent='âœ—';
    if(block)block.classList.add('loc-issue');
    if(lbl){lbl.textContent='ç•°å¸¸';lbl.classList.add('is-issue');}
    const body=document.getElementById(`loc-body-${id}`);
    if(body&&body.style.display!=='block'){body.style.display='block';if(block)block.classList.add('open');}
  }
}
function cycleDoor(){
  state.doorLocked=!state.doorLocked;
  const toggle=document.getElementById('toggle-door');
  const knob=document.getElementById('knob-door');
  const lbl=document.getElementById('lbl-door');
  if(state.doorLocked){
    toggle.classList.remove('is-issue');knob.textContent='âœ“';
    if(lbl){lbl.textContent='æ­£å¸¸';lbl.className='status-label is-ok';}
  }else{
    toggle.classList.add('is-issue');knob.textContent='âœ—';
    if(lbl){lbl.textContent='ç•°å¸¸';lbl.className='status-label is-issue';}
  }
  updateStats();
}
function updateStats(){
  const vals=Object.values(state.checks);
  const ok=vals.filter(v=>v==='ok').length;
  const ng=vals.filter(v=>v==='issue').length;
  const total=vals.length;
  document.getElementById('statOk').textContent=`æ­£å¸¸: ${ok}`;
  document.getElementById('statNg').textContent=`ç•°å¸¸: ${ng}`;
  document.getElementById('progressBar').style.width=`${Math.round(ok/total*100)}%`;
}

async function submitCheck(){
  // All checks default to 'ok', no null state â€” no need to validate unchecked
  state.overallNotes=document.getElementById('overallNotes').value;
  const ld=LOCATIONS[state.location];
  const payload={
    location:state.location,locationTitle:ld.title,
    inspectorEmployee:state.inspectorEmployee,lockerEmployee:state.lockerEmployee,
    timestamp:state.checkTimestamp.toISOString(),doorLocked:state.doorLocked,
    overallNotes:state.overallNotes,
    checks:ld.places.map(p=>({placeId:p.id,placeName:p.name,status:state.checks[p.id],note:state.placeNotes[p.id]||''}))
  };
  const btn=document.getElementById('btnSubmit');
  const spinner=document.getElementById('submitSpinner');
  btn.disabled=true;spinner.style.display='block';btn.querySelector('span').textContent='é€å‡ºä¸­...';
  try{
    if(CONFIG.DEMO_MODE){await new Promise(r=>setTimeout(r,1200));showSummary(payload);goToStep(4);}
    else{
      const res=await fetch(CONFIG.GAS_URL,{method:'POST',body:JSON.stringify({action:'submitCheck',data:payload})});
      const result=await res.json();
      if(result.success){showSummary(payload);goToStep(4);}else throw new Error(result.error||'é€å‡ºå¤±æ•—');
    }
  }catch(e){showToast('é€å‡ºå¤±æ•—ï¼š'+e.message,'err');}
  finally{btn.disabled=false;spinner.style.display='none';btn.querySelector('span').textContent='é€å‡ºå®‰å…¨æª¢æŸ¥';}
}

function showSummary(payload){
  document.getElementById('sumLocation').textContent=payload.locationTitle;
  document.getElementById('sumInspector').textContent=`${payload.inspectorEmployee.nameEn} (${payload.inspectorEmployee.id})`;
  const lockerRow=document.getElementById('sumLockerRow');
  if(payload.lockerEmployee){lockerRow.style.display='flex';document.getElementById('sumLocker').textContent=`${payload.lockerEmployee.nameEn} (${payload.lockerEmployee.id})`;}
  else{lockerRow.style.display='none';}
  document.getElementById('sumTime').textContent=new Date(payload.timestamp).toLocaleString('zh-TW',{hour12:false});
  document.getElementById('sumDoor').innerHTML=payload.doorLocked?'<span class="ok">âœ“ å·²ä¸Šé–</span>':'<span class="ng">âœ— ç•°å¸¸</span>';
  const allOk=payload.checks.every(c=>c.status==='ok')&&payload.doorLocked;
  document.getElementById('sumAllOk').innerHTML=allOk?'<span class="ok">âœ“ å…¨éƒ¨æ­£å¸¸</span>':'<span class="ng">æœ‰ç•°å¸¸åœ°é»</span>';
  document.getElementById('locationSummaryList').innerHTML=payload.checks.map(c=>`
    <div class="ls-row"><span>${c.placeName}</span><div>
    ${c.note?`<span style="color:var(--amber);font-size:11px;margin-right:8px">ğŸ“ ${c.note.slice(0,20)}${c.note.length>20?'...':''}</span>`:''}
    <span class="ls-badge ${c.status==='ok'?'ok':'ng'}">${c.status==='ok'?'âœ“ OK':'âœ— ç•°å¸¸'}</span></div></div>`).join('');
}

function toggleCheckItem(placeId,idx){
  if(!state.subChecks[placeId])state.subChecks[placeId]={};
  state.subChecks[placeId][idx]=!state.subChecks[placeId][idx];
  const item=document.getElementById(`ci-${placeId}-${idx}`);
  const bullet=document.getElementById(`cb-${placeId}-${idx}`);
  if(state.subChecks[placeId][idx]){
    item.classList.add('checked');bullet.textContent='âœ“';
  }else{
    item.classList.remove('checked');bullet.textContent='';
  }
}

function resetApp(){
  state.location=null;state.inspectorEmployee=null;state.lockerEmployee=null;
  state.checkTimestamp=null;state.checks={};state.placeNotes={};state.subChecks={};state.doorLocked=true;state.overallNotes='';
  document.getElementById('inspectorSearch').value='';
  document.getElementById('lockerSearch').value='';
  document.getElementById('inspectorSelected').style.display='none';
  document.getElementById('lockerSelected').style.display='none';
  document.getElementById('overallNotes').value='';
  document.getElementById('checklistContainer').innerHTML='';
  goToStep(1);
}

let toastTimer=null;
function showToast(msg,type='info'){
  const toast=document.getElementById('toast');
  document.getElementById('toastIcon').textContent=type==='err'?'âš ï¸':type==='ok'?'âœ…':'â„¹ï¸';
  document.getElementById('toastMsg').textContent=msg;
  toast.className=`toast show ${type==='err'?'toast-err':type==='ok'?'toast-ok':''}`;
  if(toastTimer)clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>toast.classList.remove('show'),3000);
}
</script>
</body>
</html>
